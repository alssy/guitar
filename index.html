<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Guitar Fretboard Master</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; text-align: center; background: #1a1a1a; color: #fff; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: #2d2d2d; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn-group { margin: 15px 0; display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; }
        button { padding: 12px; cursor: pointer; border: 1px solid #444; background: #3d3d3d; color: #fff; border-radius: 8px; transition: 0.2s; }
        button:hover { background: #555; }
        button.active { background: #007bff; border-color: #007bff; font-weight: bold; }
        .display { font-size: 4rem; margin: 30px 0; color: #00d1b2; text-shadow: 0 0 20px rgba(0,209,178,0.3); }
        .timer { font-size: 1.1rem; color: #aaa; margin-bottom: 10px; }
        input, select { background: #3d3d3d; color: #fff; border: 1px solid #555; padding: 5px; border-radius: 5px; }
        .start-btn { background: #28a745; color: white; width: 100%; font-size: 1.5rem; border: none; padding: 15px; margin-top: 20px; border-radius: 10px; cursor: pointer; }
        .start-btn.stop { background: #dc3545; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ¸ ì§€íŒ ì•”ê¸° íŠ¸ë ˆì´ë„ˆ</h2>

    <div class="btn-group" id="note-btns">
        <button onclick="setNote('C', this)">C</button>
        <button onclick="setNote('D', this)">D</button>
        <button onclick="setNote('E', this)">E</button>
        <button onclick="setNote('F', this)">F</button>
        <button onclick="setNote('G', this)">G</button>
        <button onclick="setNote('A', this)">A</button>
        <button onclick="setNote('B', this)">B</button>
    </div>

    <div class="btn-group" id="acc-btns">
        <button class="active" onclick="setAcc('', this)">None</button>
        <button onclick="setAcc('#', this)">â™¯ (Sharp)</button>
        <button onclick="setAcc('b', this)">â™­ (Flat)</button>
    </div>

    <div style="margin: 20px 0; font-size: 0.9rem; color: #ccc;">
        BPM: <input type="number" id="bpm" value="60" min="30" max="200" style="width: 50px;"> |
        ì‹œê°„: 
        <select id="duration">
            <option value="60">1ë¶„</option>
            <option value="180">3ë¶„</option>
            <option value="300">5ë¶„</option>
        </select>
    </div>

    <hr style="border: 0.5px solid #444;">

    <div class="timer" id="time-left">ì—°ìŠµ ì¤€ë¹„ ì™„ë£Œ</div>
    <div class="display" id="string-display">READY</div>
    <div id="target-note" style="font-size: 1.2rem; color: #007bff;">ìŒì„ ì„ íƒí•´ ì£¼ì„¸ìš”</div>

    <button class="start-btn" id="start-stop" onclick="toggleStart()">START</button>
</div>

<script>
    let selectedNote = '';
    let selectedAccidental = '';
    let isRunning = false;
    let intervalId, timerId;
    let currentStep = 0;
    const sequence = [6, 5, 4, 3, 2, 1, 2, 3, 4, 5];

    // ì£¼íŒŒìˆ˜ ë§µ (4ì˜¥íƒ€ë¸Œ ê¸°ì¤€ ì£¼íŒŒìˆ˜)
    const noteFrequencies = {
        'C': 261.63, 'C#': 277.18, 'Db': 277.18, 'D': 293.66, 'D#': 311.13, 'Eb': 311.13,
        'E': 329.63, 'F': 349.23, 'F#': 369.99, 'Gb': 369.99, 'G': 392.00, 'G#': 415.30,
        'Ab': 415.30, 'A': 440.00, 'A#': 466.16, 'Bb': 466.16, 'B': 493.88
    };

    // ê¸°íƒ€ ì¤„ë³„ ê¸°ë³¸ ì˜¥íƒ€ë¸Œ ì°¨ì´ ì ìš©
    const stringOctaveOffset = { 6: 0.25, 5: 0.33, 4: 0.5, 3: 0.66, 2: 0.85, 1: 1.0 };

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function setNote(note, btn) {
        selectedNote = note;
        updateUI('note-btns', btn);
    }

    function setAcc(acc, btn) {
        selectedAccidental = acc;
        updateUI('acc-btns', btn);
    }

    function updateUI(groupId, activeBtn) {
        document.querySelectorAll(`#${groupId} button`).forEach(b => b.classList.remove('active'));
        activeBtn.classList.add('active');
        document.getElementById('target-note').innerText = `ì—°ìŠµ ëª©í‘œ: ${selectedNote}${selectedAccidental}`;
    }

    function playGuitarSound(noteName, stringNum) {
        const baseFreq = noteFrequencies[noteName];
        if (!baseFreq) return;

        // ì¤„ ë²ˆí˜¸ì— ë”°ë¼ ì˜¥íƒ€ë¸Œ ì¡°ì • (ê¸°íƒ€ì˜ ì‹¤ì œ ìŒì—­ëŒ€ ì‹œë®¬ë ˆì´ì…˜)
        let freq = baseFreq;
        if (stringNum >= 4) freq /= 2; // 4, 5, 6ë²ˆì¤„ì€ í•œ ì˜¥íƒ€ë¸Œ ë‚®ê²Œ
        if (stringNum >= 6) freq /= 2; // 6ë²ˆì¤„ì€ ë” ë‚®ê²Œ

        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();

        osc.type = 'triangle'; // ê¸°íƒ€ì™€ ìœ ì‚¬í•œ ë¶€ë“œëŸ¬ìš´ íŒŒí˜•
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);

        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);

        osc.connect(gain);
        gain.connect(audioCtx.destination);

        osc.start();
        osc.stop(audioCtx.currentTime + 0.8);
    }

    function toggleStart() {
        if (isRunning) {
            stop();
        } else {
            if (!selectedNote) return alert('ìŒì„ ì„ íƒí•˜ì„¸ìš”!');
            start();
        }
    }

    function start() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        isRunning = true;
        const btn = document.getElementById('start-stop');
        btn.innerText = 'STOP';
        btn.classList.add('stop');

        const bpm = document.getElementById('bpm').value;
        const ms = (60 / bpm) * 1000;
        let timeLeft = parseInt(document.getElementById('duration').value);

        intervalId = setInterval(() => {
            const stringNum = sequence[currentStep];
            document.getElementById('string-display').innerText = stringNum + "ë²ˆ ì¤„";
            playGuitarSound(selectedNote + selectedAccidental, stringNum);
            currentStep = (currentStep + 1) % sequence.length;
        }, ms);

        timerId = setInterval(() => {
            timeLeft--;
            document.getElementById('time-left').innerText = `ë‚¨ì€ ì‹œê°„: ${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,'0')}`;
            if (timeLeft <= 0) stop();
        }, 1000);
    }

    function stop() {
        isRunning = false;
        clearInterval(intervalId);
        clearInterval(timerId);
        const btn = document.getElementById('start-stop');
        btn.innerText = 'START';
        btn.classList.remove('stop');
        document.getElementById('string-display').innerText = 'END';
        currentStep = 0;
    }
</script>
</body>
</html>
