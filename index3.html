<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í∏∞ÌÉÄ ÏßÄÌåê Ïó∞ÏäµÍ∏∞ - Í∞úÏÑ†Ìåê</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        .fret-active {
            animation: pulse 0.5s ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .nut {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
        }
        .fret-marker {
            background: radial-gradient(circle at 30% 30%, #fbbf24, #f59e0b);
        }
        .progress-ring {
            animation: progress-ring 1s ease-out forwards;
        }
        @keyframes progress-ring {
            from { stroke-dashoffset: 283; }
            to { stroke-dashoffset: var(--progress); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const GuitarFretboardTrainer = () => {
            // ÏÉÅÌÉú Í¥ÄÎ¶¨
            const [selectedNote, setSelectedNote] = useState('C');
            const [useSharp, setUseSharp] = useState(false);
            const [useFlat, setUseFlat] = useState(false);
            const [bpm, setBpm] = useState(60);
            const [duration, setDuration] = useState(1);
            const [isPlaying, setIsPlaying] = useState(false);
            const [currentString, setCurrentString] = useState(null);
            const [currentFret, setCurrentFret] = useState(null);
            const [direction, setDirection] = useState('ascending');
            const [shouldStop, setShouldStop] = useState(false);
            const [timeRemaining, setTimeRemaining] = useState(0);
            const [scaleMode, setScaleMode] = useState('single'); // single, major, minor
            const [fretRange, setFretRange] = useState({ min: 1, max: 12 });
            const [patternType, setPatternType] = useState('ascending'); // ascending, descending, random, alternating
            const [showHint, setShowHint] = useState(false);
            const [practiceStats, setPracticeStats] = useState({
                totalNotes: 0,
                correctNotes: 0,
                streak: 0,
                maxStreak: 0
            });
            const [sessionHistory, setSessionHistory] = useState([]);
            const [isAudioReady, setIsAudioReady] = useState(false);
            const [metronomeEnabled, setMetronomeEnabled] = useState(true);
            const [selectedScale, setSelectedScale] = useState('C'); // Î©îÏù¥Ï†Ä/ÎßàÏù¥ÎÑà Ïä§ÏºÄÏùº Í∏∞Ï§ÄÏùå
            const [scaleType, setScaleType] = useState('major'); // major, minor
            
            // Î†àÌçºÎü∞Ïä§
            const synthRef = useRef(null);
            const clickRef = useRef(null);
            const loopRef = useRef(null);
            const beatCountRef = useRef(0);
            const timerRef = useRef(null);
            const intervalRef = useRef(null);
            const audioContextRef = useRef(null);
            const patternRef = useRef([]);
            const currentPosIndexRef = useRef(0);
            const lastPlayedTimeRef = useRef(0);

            // Í∏∞ÌÉÄ ÌòÑ ÌäúÎãù (1Î≤àÌòÑÏù¥ ÏñáÏùÄ ÌòÑ, 6Î≤àÌòÑÏù¥ ÎëêÍ∫ºÏö¥ ÌòÑ)
            const stringNotes = ['E2', 'A2', 'D3', 'G3', 'B3', 'E4'];
            
            // ÏùåÌëú Ï†ïÏùò
            const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            const notesFlat = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];
            
            // Ïä§ÏºÄÏùº Ìå®ÌÑ¥ (Î©îÏù¥Ï†Ä, ÎßàÏù¥ÎÑà)
            const scalePatterns = {
                major: [0, 2, 4, 5, 7, 9, 11], // C D E F G A B
                minor: [0, 2, 3, 5, 7, 8, 10]   // C D Eb F G Ab Bb
            };

            // Sharp/Flat Ìï∏Îì§Îü¨ - ÎèôÏãú ÏÑ†ÌÉù Î∞©ÏßÄ
            const handleSharpClick = () => {
                setUseSharp(!useSharp);
                if (!useSharp && useFlat) setUseFlat(false);
            };

            const handleFlatClick = () => {
                setUseFlat(!useFlat);
                if (!useFlat && useSharp) setUseSharp(false);
            };

            // Ïò§ÎîîÏò§ Ï¥àÍ∏∞Ìôî
            useEffect(() => {
                const initAudio = async () => {
                    try {
                        await Tone.start();
                        audioContextRef.current = Tone.getContext();
                        
                        synthRef.current = new Tone.Synth({
                            oscillator: { 
                                type: 'triangle8',
                                spread: 30
                            },
                            envelope: {
                                attack: 0.005,
                                decay: 0.1,
                                sustain: 0.3,
                                release: 1
                            }
                        }).toDestination();

                        clickRef.current = new Tone.MembraneSynth({
                            pitchDecay: 0.008,
                            octaves: 2,
                            envelope: {
                                attack: 0.0006,
                                decay: 0.05,
                                sustain: 0,
                                release: 0.1
                            }
                        }).toDestination();
                        
                        setIsAudioReady(true);
                    } catch (error) {
                        console.error('Ïò§ÎîîÏò§ Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                    }
                };

                initAudio();

                return () => {
                    if (synthRef.current) {
                        synthRef.current.dispose();
                    }
                    if (clickRef.current) {
                        clickRef.current.dispose();
                    }
                    if (loopRef.current) {
                        loopRef.current.dispose();
                    }
                    if (audioContextRef.current) {
                        audioContextRef.current.close();
                    }
                };
            }, []);

            // ÌîÑÎ†õ Î≤àÌò∏Î°ú ÏùåÌëú Í≥ÑÏÇ∞
            const getNoteFromFret = useCallback((stringIndex, fret) => {
                const baseNote = stringNotes[stringIndex];
                const noteName = baseNote.slice(0, -1);
                const octave = parseInt(baseNote.slice(-1));
                
                const noteIndex = notes.indexOf(noteName);
                const newNoteIndex = (noteIndex + fret) % 12;
                const octaveShift = Math.floor((noteIndex + fret) / 12);
                
                return notes[newNoteIndex] + (octave + octaveShift);
            }, []);

            // ÏÑ†ÌÉùÎêú Ïùå/Ïä§ÏºÄÏùºÏóê ÎßûÎäî ÌîÑÎ†õ ÏúÑÏπò Ï∞æÍ∏∞
            const findNotesOnFretboard = useCallback(() => {
                const positions = [];
                let targetNotes = [];

                if (scaleMode === 'single') {
                    // Îã®Ïùº Ïùå Ï∞æÍ∏∞
                    let targetNote = selectedNote;
                    
                    if (useSharp && !selectedNote.includes('#') && selectedNote !== 'E' && selectedNote !== 'B') {
                        const idx = notes.indexOf(selectedNote);
                        targetNote = notes[idx + 1];
                    } else if (useFlat && !selectedNote.includes('b') && selectedNote !== 'F' && selectedNote !== 'C') {
                        const idx = notes.indexOf(selectedNote);
                        targetNote = notesFlat[idx - 1];
                    }
                    targetNotes = [targetNote];
                } else if (scaleMode === 'major' || scaleMode === 'minor') {
                    // Ïä§ÏºÄÏùº Ïùå Ï∞æÍ∏∞
                    const scaleRootIndex = notes.indexOf(selectedScale);
                    const pattern = scaleMode === 'major' ? scalePatterns.major : scalePatterns.minor;
                    
                    targetNotes = pattern.map(interval => {
                        const noteIndex = (scaleRootIndex + interval) % 12;
                        return notes[noteIndex];
                    });
                }

                // 1Î≤à ÌîÑÎ†õÎ∂ÄÌÑ∞ 12Î≤à ÌîÑÎ†õÍπåÏßÄÎßå Í≤ÄÏÉâ (Í∞úÎ∞©ÌòÑ Ï†úÏô∏)
                for (let stringIdx = 0; stringIdx < 6; stringIdx++) {
                    for (let fret = fretRange.min; fret <= fretRange.max; fret++) {
                        const note = getNoteFromFret(stringIdx, fret);
                        const noteName = note.slice(0, -1);
                        
                        if (targetNotes.includes(noteName) || 
                            targetNotes.includes(notesFlat[notes.indexOf(noteName)])) {
                            positions.push({ 
                                string: stringIdx, 
                                fret, 
                                note,
                                noteName: noteName
                            });
                        }
                    }
                }
                
                return positions;
            }, [selectedNote, useSharp, useFlat, scaleMode, selectedScale, fretRange, getNoteFromFret]);

            // Ìå®ÌÑ¥ ÏÉùÏÑ±
            const generatePattern = useCallback((positions) => {
                let pattern = [];
                
                // ÌòÑÎ≥ÑÎ°ú ÏúÑÏπò Í∑∏Î£πÌôî
                const positionsByString = {};
                for (let i = 0; i < 6; i++) {
                    positionsByString[i] = positions.filter(p => p.string === i)
                        .sort((a, b) => a.fret - b.fret);
                }
                
                switch (patternType) {
                    case 'ascending':
                        // ÏïÑÎûòÌòÑ(6Î≤à)ÏóêÏÑú ÏúÑÌòÑ(1Î≤à)ÏúºÎ°ú
                        for (let s = 5; s >= 0; s--) {
                            pattern.push(...positionsByString[s]);
                        }
                        break;
                        
                    case 'descending':
                        // ÏúÑÌòÑ(1Î≤à)ÏóêÏÑú ÏïÑÎûòÌòÑ(6Î≤à)ÏúºÎ°ú
                        for (let s = 0; s <= 5; s++) {
                            pattern.push(...positionsByString[s]);
                        }
                        break;
                        
                    case 'alternating':
                        // ÏúÑÏïÑÎûò Î≤àÍ∞àÏïÑÍ∞ÄÎ©∞
                        const highStrings = [0, 1, 2]; // ÏñáÏùÄ ÌòÑ
                        const lowStrings = [3, 4, 5]; // ÎëêÍ∫ºÏö¥ ÌòÑ
                        
                        for (let i = 0; i < Math.max(highStrings.length, lowStrings.length); i++) {
                            if (i < lowStrings.length) {
                                pattern.push(...positionsByString[lowStrings[i]]);
                            }
                            if (i < highStrings.length) {
                                pattern.push(...positionsByString[highStrings[i]]);
                            }
                        }
                        break;
                        
                    case 'random':
                        // Î¨¥ÏûëÏúÑ ÏàúÏÑú
                        pattern = [...positions];
                        for (let i = pattern.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [pattern[i], pattern[j]] = [pattern[j], pattern[i]];
                        }
                        break;
                        
                    case 'stringwise':
                        // ÌòÑÎ≥ÑÎ°ú Î™®Îì† Ïùå Ïó∞Ï£º
                        for (let s = 5; s >= 0; s--) {
                            pattern.push(...positionsByString[s]);
                        }
                        for (let s = 0; s <= 5; s++) {
                            pattern.push(...positionsByString[s].reverse());
                        }
                        break;
                }
                
                return pattern;
            }, [patternType]);

            // Ïó∞Ïäµ ÏãúÏûë
            const startPractice = async () => {
                if (!isAudioReady) {
                    alert('Ïò§ÎîîÏò§Î•º Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    await Tone.start();
                    setIsPlaying(true);
                    setShouldStop(false);
                    setTimeRemaining(duration * 60);
                    beatCountRef.current = 0;
                    currentPosIndexRef.current = 0;
                    
                    // ÌÜµÍ≥Ñ Ï¥àÍ∏∞Ìôî
                    setPracticeStats({
                        totalNotes: 0,
                        correctNotes: 0,
                        streak: 0,
                        maxStreak: 0
                    });

                    const allPositions = findNotesOnFretboard();
                    
                    if (allPositions.length === 0) {
                        alert('ÏÑ†ÌÉùÌïú ÏùåÏù¥ ÌîÑÎ†õÎ≥¥ÎìúÏóê ÏóÜÏäµÎãàÎã§. ÏÑ§Ï†ïÏùÑ Î≥ÄÍ≤ΩÌï¥Ï£ºÏÑ∏Ïöî.');
                        setIsPlaying(false);
                        return;
                    }

                    patternRef.current = generatePattern(allPositions);
                    
                    Tone.Transport.bpm.value = bpm;
                    Tone.Transport.stop();
                    
                    if (loopRef.current) {
                        loopRef.current.dispose();
                    }

                    loopRef.current = new Tone.Loop((time) => {
                        beatCountRef.current++;
                        
                        // Î©îÌä∏Î°úÎÜà ÌÅ¥Î¶≠ (Ï≤´ 4Î∞ï)
                        if (metronomeEnabled && beatCountRef.current <= 4) {
                            clickRef.current.triggerAttackRelease('C2', '32n', time);
                            return;
                        }

                        // ÏùåÌëú Ïó∞Ï£º
                        if (patternRef.current.length > 0) {
                            const pos = patternRef.current[currentPosIndexRef.current];
                            
                            setCurrentString(pos.string);
                            setCurrentFret(pos.fret);
                            
                            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                            setPracticeStats(prev => ({
                                ...prev,
                                totalNotes: prev.totalNotes + 1,
                                streak: prev.streak + 1,
                                maxStreak: Math.max(prev.maxStreak, prev.streak + 1)
                            }));

                            // ÏùåÌëú Ïó∞Ï£º
                            synthRef.current.triggerAttackRelease(pos.note, '8n', time);
                            lastPlayedTimeRef.current = Tone.now();
                            
                            // Îã§Ïùå ÏúÑÏπòÎ°ú Ïù¥Îèô
                            currentPosIndexRef.current = (currentPosIndexRef.current + 1) % patternRef.current.length;
                            
                            // Ï¢ÖÎ£å Ï°∞Í±¥ Ï≤¥ÌÅ¨
                            if (currentPosIndexRef.current === 0 && shouldStop) {
                                stopPractice();
                            }
                        }
                    }, '4n').start(0);
                    
                    Tone.Transport.start();
                    
                    // ÌÉÄÏù¥Î®∏ ÏÑ§Ï†ï
                    intervalRef.current = setInterval(() => {
                        setTimeRemaining(prev => {
                            if (prev <= 1) {
                                setShouldStop(true);
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);

                    timerRef.current = setTimeout(() => {
                        setShouldStop(true);
                    }, duration * 60 * 1000);

                } catch (error) {
                    console.error('Ïó∞Ïäµ ÏãúÏûë Ïò§Î•ò:', error);
                    setIsPlaying(false);
                }
            };

            // Ïó∞Ïäµ Ï†ïÏßÄ
            const stopPractice = useCallback(() => {
                Tone.Transport.stop();
                if (loopRef.current) {
                    loopRef.current.stop();
                    loopRef.current.dispose();
                }
                if (timerRef.current) {
                    clearTimeout(timerRef.current);
                }
                if (intervalRef.current) {
                    clearInterval(intervalRef.current);
                }
                
                // ÏÑ∏ÏÖò Í∏∞Î°ù Ï†ÄÏû•
                if (practiceStats.totalNotes > 0) {
                    const session = {
                        date: new Date().toISOString(),
                        note: selectedNote,
                        scaleMode,
                        duration,
                        bpm,
                        stats: { ...practiceStats },
                        accuracy: practiceStats.totalNotes > 0 
                            ? Math.round((practiceStats.correctNotes / practiceStats.totalNotes) * 100)
                            : 0
                    };
                    setSessionHistory(prev => [session, ...prev.slice(0, 9)]);
                }
                
                setIsPlaying(false);
                setCurrentString(null);
                setCurrentFret(null);
                setShouldStop(false);
                setTimeRemaining(0);
                beatCountRef.current = 0;
                currentPosIndexRef.current = 0;
            }, [practiceStats, selectedNote, scaleMode, duration, bpm]);

            // ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;
                    
                    switch(e.key) {
                        case ' ':
                            e.preventDefault();
                            if (isPlaying) {
                                stopPractice();
                            } else {
                                startPractice();
                            }
                            break;
                        case 'ArrowUp':
                            e.preventDefault();
                            setBpm(prev => Math.min(prev + 5, 200));
                            break;
                        case 'ArrowDown':
                            e.preventDefault();
                            setBpm(prev => Math.max(prev - 5, 40));
                            break;
                        case 'h':
                            setShowHint(prev => !prev);
                            break;
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [isPlaying, stopPractice, startPractice]);

            // Ïª¥Ìè¨ÎÑåÌä∏ Ïñ∏ÎßàÏö¥Ìä∏ Ïãú Ï†ïÎ¶¨
            useEffect(() => {
                return () => {
                    stopPractice();
                };
            }, [stopPractice]);

            const positions = findNotesOnFretboard();
            const accuracy = practiceStats.totalNotes > 0 
                ? Math.round((practiceStats.correctNotes / practiceStats.totalNotes) * 100)
                : 100;

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4 md:p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Ìó§Îçî */}
                        <header className="mb-8 text-center">
                            <h1 className="text-3xl md:text-4xl font-bold text-white mb-2">
                                üé∏ Í∏∞ÌÉÄ ÏßÄÌåê Ïó∞ÏäµÍ∏∞
                            </h1>
                            <p className="text-gray-300">
                                ÌîÑÎ†õ 1Î≤àÎ∂ÄÌÑ∞ 12Î≤àÍπåÏßÄ ÏùåÌëú ÏúÑÏπò Ïó∞Ïäµ (Í∞úÎ∞©ÌòÑ Ï†úÏô∏)
                            </p>
                            <div className="mt-2 text-sm text-gray-400">
                                Îã®Ï∂ïÌÇ§: Ïä§ÌéòÏù¥Ïä§Î∞î(ÏãúÏûë/Ï†ïÏßÄ), ‚Üë‚Üì(BPM Ï°∞Ï†à), H(ÌûåÌä∏ ÌëúÏãú)
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* ÏôºÏ™Ω Ïª®Ìä∏Î°§ Ìå®ÎÑê */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Í∏∞Î≥∏ ÏÑ§Ï†ï Ïπ¥Îìú */}
                                <div className="bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 shadow-2xl border border-slate-600">
                                    <h2 className="text-xl font-bold text-white mb-4">Í∏∞Î≥∏ ÏÑ§Ï†ï</h2>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {/* Ïùå ÏÑ†ÌÉù */}
                                        <div>
                                            <label className="block text-white font-semibold mb-2">Ïùå ÏÑ†ÌÉù *</label>
                                            <div className="grid grid-cols-7 gap-1">
                                                {['C', 'D', 'E', 'F', 'G', 'A', 'B'].map(note => (
                                                    <button
                                                        key={note}
                                                        onClick={() => setSelectedNote(note)}
                                                        className={`py-2 px-3 rounded font-bold transition-all duration-200 ${
                                                            selectedNote === note
                                                                ? 'bg-blue-500 text-white shadow-lg scale-105'
                                                                : 'bg-slate-600 text-gray-300 hover:bg-slate-500 hover:scale-102'
                                                        }`}
                                                    >
                                                        {note}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Î≥ÄÌôîÌëú */}
                                        <div>
                                            <label className="block text-white font-semibold mb-2">Î≥ÄÌôîÌëú</label>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={handleSharpClick}
                                                    className={`flex-1 py-2 px-4 rounded font-bold transition-all ${
                                                        useSharp
                                                            ? 'bg-green-500 text-white shadow-lg'
                                                            : 'bg-slate-600 text-gray-300 hover:bg-slate-500'
                                                    }`}
                                                >
                                                    # (Sharp)
                                                </button>
                                                <button
                                                    onClick={handleFlatClick}
                                                    className={`flex-1 py-2 px-4 rounded font-bold transition-all ${
                                                        useFlat
                                                            ? 'bg-green-500 text-white shadow-lg'
                                                            : 'bg-slate-600 text-gray-300 hover:bg-slate-500'
                                                    }`}
                                                >
                                                    ‚ô≠ (Flat)
                                                </button>
                                            </div>
                                        </div>

                                        {/* Ïä§ÏºÄÏùº Î™®Îìú */}
                                        <div>
                                            <label className="block text-white font-semibold mb-2">Ïó∞Ïäµ Î™®Îìú</label>
                                            <select
                                                value={scaleMode}
                                                onChange={(e) => setScaleMode(e.target.value)}
                                                className="w-full bg-slate-600 text-white rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            >
                                                <option value="single">Îã®Ïùº Ïùå</option>
                                                <option value="major">Î©îÏù¥Ï†Ä Ïä§ÏºÄÏùº</option>
                                                <option value="minor">ÎßàÏù¥ÎÑà Ïä§ÏºÄÏùº</option>
                                            </select>
                                            
                                            {scaleMode !== 'single' && (
                                                <div className="mt-2">
                                                    <label className="block text-gray-300 text-sm mb-1">Ïä§ÏºÄÏùº Í∏∞Ï§ÄÏùå</label>
                                                    <select
                                                        value={selectedScale}
                                                        onChange={(e) => setSelectedScale(e.target.value)}
                                                        className="w-full bg-slate-600 text-white rounded px-3 py-2 text-sm"
                                                    >
                                                        {notes.filter(n => !n.includes('#')).map(note => (
                                                            <option key={note} value={note}>{note}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                            )}
                                        </div>

                                        {/* BPM ÏÑ§Ï†ï */}
                                        <div>
                                            <label className="block text-white font-semibold mb-2">
                                                BPM: <span className="text-yellow-300">{bpm}</span>
                                            </label>
                                            <input
                                                type="range"
                                                min="40"
                                                max="200"
                                                value={bpm}
                                                onChange={(e) => setBpm(Number(e.target.value))}
                                                className="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer slider"
                                            />
                                            <div className="flex justify-between text-xs text-gray-400 mt-1">
                                                <span>ÎäêÎ¶º</span>
                                                <span>Î≥¥ÌÜµ</span>
                                                <span>Îπ†Î¶Ñ</span>
                                            </div>
                                        </div>

                                        {/* Ïó∞Ïäµ ÏãúÍ∞Ñ */}
                                        <div>
                                            <label className="block text-white font-semibold mb-2">
                                                Ïó∞Ïäµ ÏãúÍ∞Ñ: <span className="text-yellow-300">{duration}Î∂Ñ</span>
                                            </label>
                                            <input
                                                type="range"
                                                min="1"
                                                max="20"
                                                value={duration}
                                                onChange={(e) => setDuration(Number(e.target.value))}
                                                className="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer slider"
                                            />
                                        </div>

                                        {/* ÌîÑÎ†õ Î≤îÏúÑ */}
                                        <div>
                                            <label className="block text-white font-semibold mb-2">
                                                ÌîÑÎ†õ Î≤îÏúÑ: <span className="text-yellow-300">{fretRange.min}Î≤à - {fretRange.max}Î≤à</span>
                                            </label>
                                            <div className="flex items-center gap-3">
                                                <input
                                                    type="range"
                                                    min="1"
                                                    max="12"
                                                    value={fretRange.min}
                                                    onChange={(e) => setFretRange(prev => ({
                                                        ...prev,
                                                        min: Math.min(Number(e.target.value), prev.max)
                                                    }))}
                                                    className="flex-1 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer slider"
                                                />
                                                <span className="text-gray-300">~</span>
                                                <input
                                                    type="range"
                                                    min="1"
                                                    max="12"
                                                    value={fretRange.max}
                                                    onChange={(e) => setFretRange(prev => ({
                                                        ...prev,
                                                        max: Math.max(Number(e.target.value), prev.min)
                                                    }))}
                                                    className="flex-1 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer slider"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    {/* Ìå®ÌÑ¥ ÏÑ§Ï†ï */}
                                    <div className="mt-6">
                                        <label className="block text-white font-semibold mb-2">Ïó∞Ïäµ Ìå®ÌÑ¥</label>
                                        <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                                            {['ascending', 'descending', 'alternating', 'random', 'stringwise'].map(type => (
                                                <button
                                                    key={type}
                                                    onClick={() => setPatternType(type)}
                                                    className={`py-2 px-3 rounded text-sm font-semibold transition-all ${
                                                        patternType === type
                                                            ? 'bg-purple-500 text-white shadow-lg'
                                                            : 'bg-slate-600 text-gray-300 hover:bg-slate-500'
                                                    }`}
                                                >
                                                    {type === 'ascending' && 'ÏïÑÎûò‚ÜíÏúÑ'}
                                                    {type === 'descending' && 'ÏúÑ‚ÜíÏïÑÎûò'}
                                                    {type === 'alternating' && 'ÍµêÏ∞®'}
                                                    {type === 'random' && 'Î¨¥ÏûëÏúÑ'}
                                                    {type === 'stringwise' && 'ÌòÑÎ≥Ñ'}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Ï∂îÍ∞Ä ÏòµÏÖò */}
                                    <div className="mt-6 flex flex-wrap gap-4">
                                        <label className="flex items-center gap-2 text-white cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={metronomeEnabled}
                                                onChange={(e) => setMetronomeEnabled(e.target.checked)}
                                                className="w-4 h-4 text-blue-600 rounded"
                                            />
                                            Î©îÌä∏Î°úÎÜà ÏÇ¨Ïö©
                                        </label>
                                        <label className="flex items-center gap-2 text-white cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={showHint}
                                                onChange={(e) => setShowHint(e.target.checked)}
                                                className="w-4 h-4 text-blue-600 rounded"
                                            />
                                            ÌûåÌä∏ ÌëúÏãú
                                        </label>
                                        <button
                                            onClick={() => document.getElementById('help-modal')?.classList.remove('hidden')}
                                            className="text-blue-400 hover:text-blue-300 underline"
                                        >
                                            ÎèÑÏõÄÎßê
                                        </button>
                                    </div>
                                </div>

                                {/* ÏßÄÌåê ÌëúÏãú */}
                                <div className="bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 shadow-2xl border border-slate-600">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold text-white">
                                            {scaleMode === 'single' 
                                                ? `${selectedNote}${useSharp ? '#' : ''}${useFlat ? '‚ô≠' : ''} ÏúÑÏπò`
                                                : `${selectedScale} ${scaleMode === 'major' ? 'Î©îÏù¥Ï†Ä' : 'ÎßàÏù¥ÎÑà'} Ïä§ÏºÄÏùº`
                                            }
                                        </h2>
                                        <span className="text-gray-300">
                                            Ï¥ù {positions.length}Í∞ú ÏúÑÏπò
                                        </span>
                                    </div>
                                    
                                    <div className="overflow-x-auto">
                                        <div className="inline-block min-w-full">
                                            {/* ÌîÑÎ†õ Î≤àÌò∏ ÌëúÏãú */}
                                            <div className="flex mb-2 pl-16">
                                                <div className="w-16 text-center text-gray-400 text-sm font-bold nut rounded">
                                                    ÎÑõ
                                                </div>
                                                {[...Array(12)].map((_, i) => (
                                                    <div key={i} className="w-12 text-center text-gray-400 text-sm font-bold">
                                                        {i + 1}
                                                        {(i === 2 || i === 4 || i === 6 || i === 8 || i === 11) && (
                                                            <div className="w-1 h-1 bg-yellow-400 rounded-full mx-auto mt-1"></div>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>

                                            {/* ÌòÑÎ≥Ñ ÌîÑÎ†õ ÌëúÏãú */}
                                            {[...Array(6)].map((_, stringIdx) => {
                                                const stringNumber = 6 - stringIdx; // 1Î≤àÌòÑÏù¥ ÏúÑÏ™Ω
                                                return (
                                                    <div key={stringIdx} className="flex items-center mb-3">
                                                        {/* ÌòÑ Î≤àÌò∏ */}
                                                        <div className="w-12 text-white font-bold text-right pr-4">
                                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center ${
                                                                currentString === stringIdx ? 'bg-yellow-400 text-black' : 'bg-slate-600'
                                                            }`}>
                                                                {stringNumber}
                                                            </div>
                                                        </div>
                                                        
                                                        {/* ÎÑõ */}
                                                        <div className="w-16 flex justify-center">
                                                            <div className="w-12 h-1 bg-gray-300 rounded-full relative">
                                                                <div className="absolute -top-1 left-1/2 transform -translate-x-1/2 w-1 h-3 bg-gray-400 rounded"></div>
                                                            </div>
                                                        </div>

                                                        {/* ÌîÑÎ†õÎì§ */}
                                                        <div className="flex items-center flex-1 relative">
                                                            <div className="absolute h-0.5 bg-gray-400 w-full"></div>
                                                            {[...Array(12)].map((_, fret) => {
                                                                const isTarget = positions.some(
                                                                    p => p.string === stringIdx && p.fret === (fret + 1)
                                                                );
                                                                const isCurrent = currentString === stringIdx && currentFret === (fret + 1);
                                                                const showMarker = (fret === 2 || fret === 4 || fret === 6 || fret === 8 || fret === 11);
                                                                
                                                                return (
                                                                    <div key={fret} className="w-12 flex justify-center relative group">
                                                                        {/* ÌîÑÎ†õÏÑ† */}
                                                                        <div className="absolute right-0 top-0 h-full w-0.5 bg-gray-600"></div>
                                                                        
                                                                        {/* ÌîÑÎ†õ ÎßàÏª§ */}
                                                                        {showMarker && (
                                                                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                                                                                <div className="w-2 h-2 fret-marker rounded-full opacity-50"></div>
                                                                            </div>
                                                                        )}
                                                                        
                                                                        {/* ÏùåÌëú ÏúÑÏπò ÌëúÏãú */}
                                                                        {isTarget && (
                                                                            <div
                                                                                className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all duration-300 relative z-10 ${
                                                                                    isCurrent
                                                                                        ? 'bg-yellow-400 text-black shadow-lg scale-125 fret-active'
                                                                                        : 'bg-blue-500/90 text-white shadow-md hover:scale-110'
                                                                                }`}
                                                                                title={`${stringNumber}Î≤àÏ§Ñ ${fret + 1}ÌîÑÎ†õ`}
                                                                            >
                                                                                {showHint ? (
                                                                                    <div className="text-xs">{positions.find(p => p.string === stringIdx && p.fret === fret+1)?.noteName}</div>
                                                                                ) : (
                                                                                    fret + 1
                                                                                )}
                                                                            </div>
                                                                        )}
                                                                        
                                                                        {/* ÌîÑÎ†õ Î≤àÌò∏ ÌûåÌä∏ */}
                                                                        <div className="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity">
                                                                            {fret + 1}
                                                                        </div>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Ïò§Î•∏Ï™Ω Ìå®ÎÑê */}
                            <div className="space-y-6">
                                {/* Ïª®Ìä∏Î°§ Î≤ÑÌäº */}
                                <div className="bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 shadow-2xl border border-slate-600">
                                    <div className="text-center mb-6">
                                        {!isPlaying ? (
                                            <button
                                                onClick={startPractice}
                                                disabled={!isAudioReady}
                                                className="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-4 px-8 rounded-xl text-xl transition-all duration-300 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                {isAudioReady ? 'üéµ Ïó∞Ïäµ ÏãúÏûë' : 'Ïò§ÎîîÏò§ Ï§ÄÎπÑ Ï§ë...'}
                                            </button>
                                        ) : (
                                            <button
                                                onClick={stopPractice}
                                                className="w-full bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white font-bold py-4 px-8 rounded-xl text-xl transition-all duration-300 shadow-lg hover:shadow-xl"
                                            >
                                                ‚èπÔ∏è Ïó∞Ïäµ Ï†ïÏßÄ
                                            </button>
                                        )}
                                    </div>

                                    {/* ÏßÑÌñâ ÏÉÅÌô© */}
                                    {isPlaying && (
                                        <div className="space-y-4">
                                            <div className="text-center">
                                                <div className="text-white font-semibold mb-2">ÎÇ®ÏùÄ ÏãúÍ∞Ñ</div>
                                                <div className="text-3xl font-bold text-yellow-300">
                                                    {Math.floor(timeRemaining / 60)}:{String(timeRemaining % 60).padStart(2, '0')}
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <div className="flex justify-between mb-1">
                                                    <span className="text-white text-sm">ÏßÑÌñâÎ•†</span>
                                                    <span className="text-white text-sm">
                                                        {Math.round(100 - (timeRemaining / (duration * 60)) * 100)}%
                                                    </span>
                                                </div>
                                                <div className="w-full bg-slate-600 rounded-full h-3 overflow-hidden">
                                                    <div
                                                        className="bg-gradient-to-r from-blue-500 via-green-500 to-yellow-500 h-3 transition-all duration-1000 ease-out"
                                                        style={{
                                                            width: `${100 - (timeRemaining / (duration * 60)) * 100}%`
                                                        }}
                                                    ></div>
                                                </div>
                                            </div>
                                            
                                            {/* ÌòÑÏû¨ Ïó∞Ï£º ÏúÑÏπò */}
                                            {currentString !== null && currentFret !== null && (
                                                <div className="text-center p-4 bg-slate-600/50 rounded-lg">
                                                    <div className="text-gray-300 mb-1">ÌòÑÏû¨ Ïó∞Ï£º Ï§ë</div>
                                                    <div className="text-2xl font-bold text-white">
                                                        {6 - currentString}Î≤àÏ§Ñ ‚Ä¢ {currentFret}ÌîÑÎ†õ
                                                    </div>
                                                    <div className="text-gray-400 text-sm mt-1">
                                                        Îã§Ïùå ÏùåÍπåÏßÄ: {(60 / bpm).toFixed(2)}Ï¥à
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>

                                {/* ÌÜµÍ≥Ñ */}
                                <div className="bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 shadow-2xl border border-slate-600">
                                    <h3 className="text-lg font-bold text-white mb-4">üìä Ïó∞Ïäµ ÌÜµÍ≥Ñ</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="text-center p-3 bg-slate-600/50 rounded-lg">
                                            <div className="text-gray-300 text-sm">Ï†ïÌôïÎèÑ</div>
                                            <div className="text-2xl font-bold text-green-400">{accuracy}%</div>
                                        </div>
                                        <div className="text-center p-3 bg-slate-600/50 rounded-lg">
                                            <div className="text-gray-300 text-sm">Ïó∞ÏÜç Ï†ïÎãµ</div>
                                            <div className="text-2xl font-bold text-yellow-400">{practiceStats.streak}</div>
                                        </div>
                                        <div className="text-center p-3 bg-slate-600/50 rounded-lg">
                                            <div className="text-gray-300 text-sm">ÏµúÎåÄ Ïó∞ÏÜç</div>
                                            <div className="text-2xl font-bold text-purple-400">{practiceStats.maxStreak}</div>
                                        </div>
                                        <div className="text-center p-3 bg-slate-600/50 rounded-lg">
                                            <div className="text-gray-300 text-sm">Ï¥ù ÏùåÌëú</div>
                                            <div className="text-2xl font-bold text-blue-400">{practiceStats.totalNotes}</div>
                                        </div>
                                    </div>
                                    
                                    {/* ÏßÑÌñâÎ•† ÎßÅ */}
                                    <div className="mt-6 flex justify-center">
                                        <div className="relative w-32 h-32">
                                            <svg className="w-full h-full" viewBox="0 0 100 100">
                                                <circle
                                                    cx="50"
                                                    cy="50"
                                                    r="45"
                                                    fill="none"
                                                    stroke="#334155"
                                                    strokeWidth="8"
                                                />
                                                <circle
                                                    cx="50"
                                                    cy="50"
                                                    r="45"
                                                    fill="none"
                                                    stroke="url(#gradient)"
                                                    strokeWidth="8"
                                                    strokeLinecap="round"
                                                    strokeDasharray="283"
                                                    strokeDashoffset={283 - (accuracy * 283 / 100)}
                                                    style={{transition: 'stroke-dashoffset 1s ease-out'}}
                                                />
                                                <defs>
                                                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                                        <stop offset="0%" stopColor="#3b82f6" />
                                                        <stop offset="100%" stopColor="#10b981" />
                                                    </linearGradient>
                                                </defs>
                                            </svg>
                                            <div className="absolute inset-0 flex items-center justify-center">
                                                <div className="text-center">
                                                    <div className="text-2xl font-bold text-white">{accuracy}%</div>
                                                    <div className="text-xs text-gray-400">Ï†ïÌôïÎèÑ</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Ïó∞Ïäµ Í∏∞Î°ù */}
                                <div className="bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 shadow-2xl border border-slate-600">
                                    <h3 className="text-lg font-bold text-white mb-4">üìù ÏµúÍ∑º Ïó∞Ïäµ Í∏∞Î°ù</h3>
                                    <div className="space-y-3 max-h-60 overflow-y-auto">
                                        {sessionHistory.length > 0 ? (
                                            sessionHistory.map((session, idx) => (
                                                <div key={idx} className="p-3 bg-slate-600/30 rounded-lg">
                                                    <div className="flex justify-between">
                                                        <span className="text-white font-semibold">
                                                            {session.note}
                                                            {session.scaleMode !== 'single' && ` ${session.scaleMode}`}
                                                        </span>
                                                        <span className="text-yellow-300">{session.accuracy}%</span>
                                                    </div>
                                                    <div className="flex justify-between text-xs text-gray-400 mt-1">
                                                        <span>{new Date(session.date).toLocaleTimeString()}</span>
                                                        <span>{session.duration}Î∂Ñ ‚Ä¢ {session.bpm} BPM</span>
                                                    </div>
                                                </div>
                                            ))
                                        ) : (
                                            <div className="text-center text-gray-400 py-4">
                                                ÏïÑÏßÅ Ïó∞Ïäµ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* ÎèÑÏõÄÎßê Î™®Îã¨ */}
                        <div id="help-modal" className="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
                            <div className="bg-slate-800 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold text-white">ÎèÑÏõÄÎßê</h3>
                                    <button
                                        onClick={() => document.getElementById('help-modal').classList.add('hidden')}
                                        className="text-gray-400 hover:text-white text-2xl"
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="space-y-4 text-gray-300">
                                    <div>
                                        <h4 className="font-bold text-white mb-2">üéØ Í∏∞Î≥∏ ÏÇ¨Ïö©Î≤ï</h4>
                                        <ul className="list-disc pl-5 space-y-1">
                                            <li>Ïùå ÏÑ†ÌÉù ÌõÑ Ïó∞Ïäµ ÏãúÏûë Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ Ìï¥Îãπ ÏùåÏùò ÏúÑÏπòÎ•º Ïó∞ÏäµÌï©ÎãàÎã§</li>
                                            <li>ÌîÑÎ†õ 1Î≤àÎ∂ÄÌÑ∞ 12Î≤àÍπåÏßÄÎßå ÏÇ¨Ïö©Ìï©ÎãàÎã§ (Í∞úÎ∞©ÌòÑ Ï†úÏô∏)</li>
                                            <li>BPMÏúºÎ°ú Ïó∞Ï£º ÏÜçÎèÑÎ•º Ï°∞Ï†àÌï† Ïàò ÏûàÏäµÎãàÎã§</li>
                                            <li>Ïó∞Ïäµ ÏãúÍ∞ÑÏùÑ ÏÑ§Ï†ïÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú Ï¢ÖÎ£åÎê©ÎãàÎã§</li>
                                        </ul>
                                    </div>
                                    
                                    <div>
                                        <h4 className="font-bold text-white mb-2">üé∏ Ïó∞Ïäµ Î™®Îìú</h4>
                                        <ul className="list-disc pl-5 space-y-1">
                                            <li><strong>Îã®Ïùº Ïùå</strong>: ÏÑ†ÌÉùÌïú Ïùå ÌïòÎÇòÎßå Ïó∞Ïäµ</li>
                                            <li><strong>Î©îÏù¥Ï†Ä Ïä§ÏºÄÏùº</strong>: ÏÑ†ÌÉùÌïú ÏùåÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Î©îÏù¥Ï†Ä Ïä§ÏºÄÏùº Ïó∞Ïäµ</li>
                                            <li><strong>ÎßàÏù¥ÎÑà Ïä§ÏºÄÏùº</strong>: ÏÑ†ÌÉùÌïú ÏùåÏùÑ Í∏∞Ï§ÄÏúºÎ°ú ÎßàÏù¥ÎÑà Ïä§ÏºÄÏùº Ïó∞Ïäµ</li>
                                        </ul>
                                    </div>
                                    
                                    <div>
                                        <h4 className="font-bold text-white mb-2">üéµ Ïó∞Ïäµ Ìå®ÌÑ¥</h4>
                                        <ul className="list-disc pl-5 space-y-1">
                                            <li><strong>ÏïÑÎûò‚ÜíÏúÑ</strong>: 6Î≤àÏ§Ñ(ÎëêÍ∫ºÏö¥ ÌòÑ)ÏóêÏÑú 1Î≤àÏ§Ñ(ÏñáÏùÄ ÌòÑ)ÏúºÎ°ú</li>
                                            <li><strong>ÏúÑ‚ÜíÏïÑÎûò</strong>: 1Î≤àÏ§ÑÏóêÏÑú 6Î≤àÏ§ÑÎ°ú</li>
                                            <li><strong>ÍµêÏ∞®</strong>: ÏïÑÎûòÌòÑÍ≥º ÏúÑÌòÑÏùÑ Î≤àÍ∞àÏïÑ Ïó∞Ï£º</li>
                                            <li><strong>Î¨¥ÏûëÏúÑ</strong>: ÏúÑÏπòÎ•º ÎûúÎç§ ÏàúÏÑúÎ°ú Ïó∞Ï£º</li>
                                            <li><strong>ÌòÑÎ≥Ñ</strong>: Ìïú Ï§ÑÏî© Î™®Îì† ÏùåÏùÑ Ïó∞Ï£º</li>
                                        </ul>
                                    </div>
                                    
                                    <div>
                                        <h4 className="font-bold text-white mb-2">‚å®Ô∏è ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§</h4>
                                        <ul className="list-disc pl-5 space-y-1">
                                            <li><strong>Ïä§ÌéòÏù¥Ïä§Î∞î</strong>: Ïó∞Ïäµ ÏãúÏûë/Ï†ïÏßÄ</li>
                                            <li><strong>‚Üë/‚Üì ÌôîÏÇ¥Ìëú</strong>: BPM Ï¶ùÍ∞Ä/Í∞êÏÜå</li>
                                            <li><strong>H</strong>: ÌûåÌä∏ ÌëúÏãú Ï†ÑÌôò</li>
                                        </ul>
                                    </div>
                                    
                                    <div className="pt-4 border-t border-slate-700">
                                        <p className="text-sm text-gray-400">
                                            Tip: Ï†ïÍ∏∞Ï†ÅÏù∏ Ïó∞ÏäµÏù¥ Ï§ëÏöîÌï©ÎãàÎã§. ÌïòÎ£® 15Î∂ÑÏî© Íæ∏Ï§ÄÌûà Ïó∞ÏäµÌï¥Î≥¥ÏÑ∏Ïöî!
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<GuitarFretboardTrainer />, document.getElementById('root'));
    </script>
</body>
</html>
